<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profesyonel Poster Oluşturucu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        /* Diğer CSS stilleri aynı kalacak */
    </style>
</head>
<body>
    <!-- HTML yapısı aynı kalacak -->

    <script>
        // Önceki JavaScript kodunun tamamı buraya gelecek
        
        // Resim olarak indirme butonu - Basitleştirilmiş versiyon
        document.getElementById('downloadImagesBtn').addEventListener('click', async function() {
            if (!originalImage || posterPages.length === 0) {
                alert('Lütfen önce bir poster oluşturun!');
                return;
            }
            
            showProgress('Resimler oluşturuluyor...', 0);
            
            try {
                // JSZip yoksa tek tek indirme yap
                if (typeof JSZip === 'undefined') {
                    for (let i = 0; i < posterPages.length; i++) {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Basit bir önizleme oluştur
                        canvas.width = originalImage.width / posterPages.length;
                        canvas.height = originalImage.height / posterPages.length;
                        
                        // Görselin ilgili kısmını çiz
                        const sx = posterPages[i].x * (originalImage.width / canvas.width);
                        const sy = posterPages[i].y * (originalImage.height / canvas.height);
                        const sw = posterPages[i].width * (originalImage.width / canvas.width);
                        const sh = posterPages[i].height * (originalImage.height / canvas.height);
                        
                        ctx.drawImage(originalImage, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);
                        
                        // İndirme bağlantısı oluştur
                        const link = document.createElement('a');
                        link.href = canvas.toDataURL('image/jpeg');
                        link.download = `poster_sayfa_${i+1}.jpg`;
                        link.click();
                        
                        // İlerleme durumunu güncelle
                        const progress = Math.floor((i / posterPages.length) * 100);
                        updateProgress(progress, `Sayfa ${i + 1} / ${posterPages.length} indiriliyor...`);
                        
                        // Biraz bekleyerek tarayıcının nefes almasını sağla
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                } else {
                    // JSZip varsa orijinal kod çalışsın
                    const zip = new JSZip();
                    const imgFolder = zip.folder("poster_sayfalar");
                    
                    // ... (orijinal JSZip kodu)
                }
                
                updateProgress(100, 'İndirme tamamlandı!');
                setTimeout(hideProgress, 1000);
            } catch (error) {
                console.error('Resim oluşturma hatası:', error);
                alert('Resimler oluşturulurken bir hata oluştu: ' + error.message);
                hideProgress();
            }
        });
    </script>

    <!-- JSZip kütüphanesini şartlı yükleme -->
    <script>
        function loadJSZip() {
            return new Promise((resolve, reject) => {
                if (typeof JSZip !== 'undefined') {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }
        
        // Buton tıklanınca JSZip'i yükle
        document.getElementById('downloadImagesBtn').addEventListener('click', async function() {
            try {
                await loadJSZip();
                // İndirme işlemini burada devam ettir
            } catch (error) {
                console.error('JSZip yüklenemedi:', error);
                alert('ZIP oluşturma özelliği yüklenemedi. Sayfalar tek tek indirilecek.');
                // Basit indirme yöntemini çağır
            }
        });
    </script>
</body>
</html>
